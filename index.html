<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
</head>
<body>
<script type="module">
import {
  showHostFns,
  testWasm,
} from "./src/js/testUtils.js"

import { instantiateWasmModuleSequence } from "./src/js/wasmUtils.js"
import { complexTestMap } from "./src/complex/tests.js"
import { mandelTestMap }  from "./src/mandel/tests.js"

const TEST_MODE   = true
const SHOW_DETAIL = true

// ---------------------------------------------------------------------------------------------------------------------
// Host functions required by the first WASM module to be instantiated.
// This object will be extended after each WASM module instantiation so that any functions exported from one module can
// (if necessary) be imported by some subsequent module
let hostFunctions = {
  math: {
    sin   : Math.sin,
    cos   : Math.cos,
    sinh  : Math.sinh,
    cosh  : Math.cosh,
    ln    : Math.log,
    atan2 : Math.atan2
  }
}

let wasmModSeq = [
  { wasmSrc : './build/complex.wasm', libName : 'cplx',   wasmObj : null },
  { wasmSrc : './build/mandel.wasm',  libName : 'mandel', wasmObj : null }
]

// ---------------------------------------------------------------------------------------------------------------------
async function start() {
  let wasmModules = await instantiateWasmModuleSequence(wasmModSeq, hostFunctions)

  testWasm(TEST_MODE, wasmModules.mandel.wasmObj.instance, mandelTestMap, SHOW_DETAIL)
  // showHostFns(hostFunctions)
}

  start()
</script>
</body>
