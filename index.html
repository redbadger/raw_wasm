<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
</head>
<body>
<script type="module">
import {
  showTestReport,
  showHostFns,
  testWasm,
} from "./src/js/testUtils.js"

import { createWasmLib } from "./src/js/wasmUtils.js"
import { complexTestMap } from "./src/complex/tests.js"

const TEST_MODE   = false
const SHOW_DETAIL = false

// -----------------------------------------------------------------------------
// Since WASM has no maths library of its own, log and trigonometric functions
// must be supplied by the host environment
let hostFunctions = {
  math: {
    sin   : Math.sin,
    cos   : Math.cos,
    sinh  : Math.sinh,
    cosh  : Math.cosh,
    ln    : Math.log,
    atan2 : Math.atan2
  }
}

// -----------------------------------------------------------------------------
// Create an instance of the WASM module, then pass it to the test framework
async function start() {
  const complexMod = await createWasmLib('./build/complex.wasm', 'cplx', hostFunctions)

  testWasm(TEST_MODE, complexMod.wasmObj.instance, complexTestMap, SHOW_DETAIL)

  const mandelMod = await createWasmLib('./build/mandel.wasm', 'mandel', complexMod.hostFns)

  // showHostFns(mandelMod)

  console.log(`mandelMod.hostFns.mandel.test_add(3,0,4,0) = ${mandelMod.hostFns.mandel.test_add(3,0,4,0)}`)
}

  start()
</script>
</body>
