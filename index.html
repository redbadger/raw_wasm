<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>
<body>
  <section id="plotArea">
    <canvas id="mandelImage" width="800" height="450"></canvas>
  </section>
<script type="module">
import {
  showHostFns,
  testWasm,
} from "./src/js/testUtils.js"

import {
  WasmModule,
  instantiateWasmModuleSequence
} from "./src/js/wasmUtils.js"

import { complexTestMap } from "./src/complex/tests.js"
import { mandelTestMap }  from "./src/mandel/tests.js"
import { colourTestMap }  from "./src/render/tests.js"

const TEST_MODE   = true
const SHOW_DETAIL = true

// ---------------------------------------------------------------------------------------------------------------------
// These WASM modules must be instantiated in the order listed below due to the fact that later modules have import
// dependencies on earlier modules
const instantiationSequence = [
  new WasmModule('./build/complex.wasm', 'cplx'),
  new WasmModule('./build/mandel.wasm',  'mandel'),
  new WasmModule('./build/canvas.wasm',  'canvas'),
]

instantiateWasmModuleSequence(instantiationSequence, { math : Math })
  .then(wasmModules => {
    testWasm(TEST_MODE, wasmModules.cplx.instance, complexTestMap, SHOW_DETAIL)
    testWasm(TEST_MODE, wasmModules.mandel.instance, mandelTestMap, SHOW_DETAIL)
    testWasm(TEST_MODE, wasmModules.canvas.instance, colourTestMap, SHOW_DETAIL)
    // showHostFns(wasmModules.hostFunctions)

    return wasmModules
  })
</script>
</body>
</html>
